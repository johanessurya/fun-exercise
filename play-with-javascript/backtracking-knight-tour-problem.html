<!DOCTYPE html>
<html>
<head>
    <title>Backtracking - Knight Tour Problem</title>
    <script src="https://unpkg.com/vue@3.1.5/dist/vue.global.prod.js"></script>
    <script src="../bower_components/underscore/underscore-min.js"></script>
    <script>
window.onload = function() {
    main();
}

function main() {
    var mainApp = {
      data: function() {
        return {
            START_POS: [0,0],
            counter: 1,
            currPos: [],
            moveList: [
                // Kanan atas
                [-2, 1],
                [-1, 2],

                // Kanan bawah
                [1, 2],
                [2, 1],

                // Kiri bawah
                [2, -1],
                [1, -2],

                // Kiri atas
                [-1, -2],
                [-2, -1]
            ],
            replayList: [],
            replayBoard: [],
            isCompleted: false,
            board: [],
            width: 5,
            message: 'Hello Vue!!'
        }
      },
      created: function() {
          var vm = this;

          var width = vm.width;
          var row = [];
          vm.board = [];
          for(var i = 0; i < width; i++) {
            row = [];
            for(var j = 0; j < width; j++) {
                row.push(0);
            }
            vm.board.push(row);
          }

          vm.replayBoard = [];
          for(var i = 0; i < width; i++) {
            row = [];
            for(var j = 0; j < width; j++) {
                row.push(0);
            }
            vm.replayBoard.push(row);
          }

            vm.currPos = vm.START_POS;
            vm.board[vm.currPos[0]][vm.currPos[1]] = 1;
            vm.replayList.push({
                counter: 1,
                backtrack: false,
                position: [vm.currPos[0], vm.currPos[1]]
            });

            // console.log('timeout');
            // debugger;

            setTimeout(function() {
                vm.loop(0)
                vm.replay(0);
            }, 0);

            /*
            do {
              hasSolution = vm.play(vm.currPos, moved, 2);
              moved++;
              console.log(moved);
            } while(!hasSolution && moved < vm.moveList.length);
            */
      },
      methods: {
          loop: function(moved) {
            var vm = this;
            var hasSolution = true;
            // var moved = 0;

            hasSolution = vm.play(vm.currPos, moved, 2);
            moved++;
            console.log(moved);

            if(!hasSolution && moved < vm.moveList.length) {
                // debugger;
                vm.loop(moved + 1);
            }

            if (vm.counter >= this.width * this.width) {
                vm.isCompleted = true;
            }
          },
          play: function(currPos, moved, counter) {
                var temp = true;
                var vm = this;
                var nextMove = [];
                var nextMoveBoard = 1;
                var isInBoard = true;
              
                nextMove = this.getNextMove(currPos, vm.moveList[moved]);
                isInBoard = vm.isInBoard(nextMove);

                if(isInBoard)
                    nextMoveBoard = vm.board[nextMove[0]][nextMove[1]];

              /*
              } while ((!isInBoard ||
                    nextMoveBoard > 0) &&
                    (moved < vm.moveList.length))
                    */
              // debugger;
              if(nextMoveBoard === 0) {
                // if(counter == 64)
                //    debugger;


                // Need this variable to skip move
                console.log(counter);
                vm.counter = counter;
                vm.board[nextMove[0]][nextMove[1]] = counter;
                vm.replayList.push({
                    counter: counter,
                    backtrack: false,
                    position: [nextMove[0], nextMove[1]]
                });

                if (counter < vm.width * vm.width) {
                    var moveCounter = 0;
                    var hasSolution = true;

                    do {
                        hasSolution = vm.play(nextMove, moveCounter, counter + 1);
                        moveCounter++;
                    } while(!hasSolution && moveCounter < vm.moveList.length);

                    if (!hasSolution && moveCounter >= vm.moveList.length) {
                        vm.board[nextMove[0]][nextMove[1]] = 0;
                        temp = false;
                        vm.replayList.push({
                            counter: counter,
                            backtrack: true,
                            position: [nextMove[0], nextMove[1]]
                        });
                    }
                }
              } else {
                temp = false;
              }

              return temp;
          },
          isInBoard: function(position) {
              return position[0] >= 0 && position[0] < this.width &&
                position[1] >= 0 && position[1] < this.width;
          },
          getNextMove: function(currPos, moved) {
              var temp = [];
              temp[0] = currPos[0] + moved[0];
              temp[1] = currPos[1] + moved[1];

              return temp;
          },
          replay: function(counter) {
              var vm = this;
              var x = 0;
              if (vm.isCompleted) {
                  x = vm.replayList[counter];
                  // debugger;

                  if (!x.backtrack) {
                      vm.replayBoard[x.position[0]][x.position[1]] = x.counter;
                  } else {
                      vm.replayBoard[x.position[0]][x.position[1]] = 0;
                  }
              }

              if (counter < vm.replayList.length) {
                  setTimeout(function() {
                    vm.replay(counter + 1);
                  }, 1000);
              }
          },
          test: function() {
              var vm = this;
              var startPos = [3, 3];

              vm.board[startPos[0]][startPos[1]] = 1;
              _.each(this.moveList, function(x, key) {
                  var temp = [];
                  temp[0] = startPos[0] + x[0];
                  temp[1] = startPos[1] + x[1];

                  vm.board[temp[0]][temp[1]] = key + 1;
              });
          }
      }
    };

    Vue.createApp(mainApp).mount('#app');
}
    </script>
    <style>
td {
    width: 70px;
    height: 70px;
    text-align: center;
    font-size: 40px;
}
    </style>
</head>
<body>
    <div id="app">
        <h1>Knight Tour Problem</h1>
        <table border="1">
            <tr v-for="x in replayBoard">
                <td v-for="y in x">{{ y == 0 ? ' ': y }}</td>
            </tr>
        </table>
    </div>
    <canvas id="mycanvas" width="600" height="600"></canvas>
</body>
</html>