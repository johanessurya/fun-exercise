<!DOCTYPE html>
<html>
<head>
    <title>Backtracking - Knight Tour Problem</title>
    <script src="../bower_components/underscore/underscore-min.js"></script>
    <script>
var Backtracking = function() {
    this.START_POS = [2, 2];
    this.counter = 1;
    this.currPos = [];
    this.moveList = [
        // Kanan atas
        [-2, 1],
        [-1, 2],

        // Kanan bawah
        [1, 2],
        [2, 1],

        // Kiri bawah
        [2, -1],
        [1, -2],

        // Kiri atas
        [-1, -2],
        [-2, -1]
    ];
    this.board = [];
    this.width = 5;

    this.init = function() {
        var vm = this;

        var row = [];
        vm.board = [];
        for(var i = 0; i < vm.width; i++) {
            row = [];
            for(var j = 0; j < vm.width; j++) {
                row.push(0);
            }
            vm.board.push(row);
        }

        console.log('timeout');
        debugger;
        vm.currPos = vm.START_POS;
        vm.board[vm.currPos[0]][vm.currPos[1]] = 1;


        setTimeout(function() {
            vm.loop(0)
        }, 0);
    };

    this.loop = function(moved) {
        var vm = this;
        var hasSolution = true;
        // var moved = 0;

        hasSolution = vm.play(vm.currPos, moved, 2);
        moved++;
        console.log(moved);

        if(!hasSolution && moved < vm.moveList.length) {
            debugger;
            vm.loop(moved + 1);
        }

        if (this.counter >= this.width * this.width) {
          console.log('Board', this.board);
        }
    };

    this.play = function(currPos, moved, counter) {
          var temp = true;
          var vm = this;
          var nextMove = [];
          var nextMoveBoard = 1;
          var isInBoard = true;

          nextMove = this.getNextMove(currPos, vm.moveList[moved]);
          isInBoard = vm.isInBoard(nextMove);

          // debugger;
          if(isInBoard)
              nextMoveBoard = vm.board[nextMove[0]][nextMove[1]];

        /*
        } while ((!isInBoard ||
              nextMoveBoard > 0) &&
              (moved < vm.moveList.length))
              */
        // debugger;
        if(nextMoveBoard === 0) {
          if(counter == 64)
              debugger;


          // Need this variable to skip move
          // debugger;
          // if (counter > 50)
             console.log(counter);

          vm.counter = counter;
          vm.board[nextMove[0]][nextMove[1]] = counter;

          var moveCounter = 0;
          var hasSolution = true;

          if (counter < this.width * this.width) {
            do {
                hasSolution = vm.play(nextMove, moveCounter, counter + 1);
                moveCounter++;

            } while(!hasSolution && moveCounter < vm.moveList.length);

            if (!hasSolution && moveCounter >= vm.moveList.length) {
                vm.board[nextMove[0]][nextMove[1]] = 0;
                temp = false;
                // debugger;
            }
          }
        } else {
          temp = false;
        }

        return temp;
    };

    this.isInBoard = function(position) {
        return position[0] >= 0 && position[0] < this.width &&
          position[1] >= 0 && position[1] < this.width;
    };

    this.getNextMove = function(currPos, moved) {
        var temp = [];
        temp[0] = currPos[0] + moved[0];
        temp[1] = currPos[1] + moved[1];

        return temp;
    };

    this.test = function() {
        var vm = this;
        var startPos = [3, 3];

        vm.board[startPos[0]][startPos[1]] = 1;
        _.each(this.moveList, function(x, key) {
            var temp = [];
            temp[0] = startPos[0] + x[0];
            temp[1] = startPos[1] + x[1];

            vm.board[temp[0]][temp[1]] = key + 1;
        });
    }
}

var backtracking = new Backtracking();
backtracking.init();
    </script>
    <style>
td {
    width: 20px;
    height: 20px;
    text-align: center;
}        
    </style>
</head>
<body>
    <div id="app">
        <h1>Knight Tour Problem</h1>
    </div>
</body>
</html>